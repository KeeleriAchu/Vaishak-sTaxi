<!DOCTYPE html>
<html>
<head>
<title>VAISHAK TAXI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body{
    min-height:100vh;
    background: url("b.png") no-repeat center center / cover;
}
.box{
    max-width:1200px;
    margin:auto;
    background-color: transparent;
    backdrop-filter: blur(8px);
    padding:25px;
    border-radius:15px;
    box-shadow:0 10px 20px rgba(255, 255, 255, 0.2);
}
.hidden{display:none}
input,button{
    padding:10px;
    margin:5px;
    border-radius:8px;
    border:1px solid #ccc;
}
button{
    background:#00bcd4;
    border:none;
    cursor:pointer;
}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th,td{
    padding:10px;
    border-bottom:1px solid #ccc;
}
th{background:#ffffff}
.reject{
    background:red;
    color:#fff;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h2 style="font-size: 20px;color: rgb(255, 149, 0);font-weight: bold">TAXI OWNER</h2>
<input id="luser" placeholder="Username">
<input id="lpass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p>
<a href="#" onclick="showRegister()" style="color: rgb(255, 179, 0);">New Owner?</a> |
<a href="#" onclick="showForgot()" style="color: rgb(255, 187, 0);">Forgot Password</a>
</p>
<p id="msg"></p>
</div>

<!-- REGISTER -->
<div class="box hidden" id="registerBox">
<h2 style="color: rgb(0, 162, 255);">Register Owner</h2>
<input id="ruser" placeholder="Username">
<input id="rpass" type="password" placeholder="Password">
<input id="rphone" placeholder="Registered Phone Number">
<button onclick="register()" style="color: rgb(255, 0, 0);">Register</button>
</div>

<!-- FORGOT PASSWORD -->
<div class="box hidden" id="forgotBox">
<h2>Forgot Password</h2>
<button onclick="sendOTP()">Send OTP</button>
<p id="otpMsg"></p>
<input id="otpInput" placeholder="Enter OTP">
<input id="newPass" type="password" placeholder="New Password">
<button onclick="resetPass()" style="color: rgb(255, 0, 0);">Reset Password</button>
</div>

<!-- DASHBOARD -->
<div class="box hidden" id="dashboard">
<h2 style="
font-family: 'Permanent Marker', cursive;
font-size: 48px;color: rgb(255, 128, 0);
letter-spacing: 2px;
"><center>TAXI</center></h2>

<h4 style="font-size: 20px;color: rgb(255, 255, 255);font-weight: bold">OWNER WATSAPP NUMBER</h4>
<input id="num">
<button onclick="saveNumber()">Save</button>

<table style="font-size: 20px; color: rgb(0, 0, 0); font-family: 'Courier New', monospace; font-weight: bold">
<thead>
<tr>
<th>Name</th>
<th>Pickup</th>
<th>Drop</th>
<th>KM</th>
<th>Fare</th>
<th>Date & Time</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>
</div>

<script>
let OTP = "";

/* SHOW SECTIONS */
function showRegister(){
    loginBox.classList.add("hidden");
    registerBox.classList.remove("hidden");
}
function showForgot(){
    loginBox.classList.add("hidden");
    forgotBox.classList.remove("hidden");
}

/* REGISTER */
function register(){
    localStorage.setItem("ownerUser", ruser.value);
    localStorage.setItem("ownerPass", rpass.value);
    localStorage.setItem("ownerPhone", rphone.value);
    alert("Owner Registered Successfully");
    location.reload();
}

/* LOGIN */
function login(){
    if(
        luser.value === localStorage.getItem("ownerUser") &&
        lpass.value === localStorage.getItem("ownerPass")
    ){
        loginBox.classList.add("hidden");
        dashboard.classList.remove("hidden");
        loadBookings();
    }else{
        msg.innerText = "Invalid login";
    }
}

/* SEND OTP = LAST 3 DIGITS (HIDDEN) */
function sendOTP(){
    const phone = localStorage.getItem("ownerPhone");

    if(!phone || phone.length < 3){
        otpMsg.innerText = "No valid registered phone number found";
        return;
    }

    // OTP = last 3 digits (hidden)
    OTP = phone.slice(-3);

    // Do NOT show OTP
    otpMsg.innerText = "OTP sent to registered number";
}

/* RESET PASSWORD */
function resetPass(){
    if(otpInput.value === OTP){
        localStorage.setItem("ownerPass", newPass.value);
        alert("Password reset successful");
        location.reload();
    }else{
        alert("Invalid OTP");
    }
}

/* SAVE OWNER NUMBER */
function saveNumber(){
    localStorage.setItem("ownerNumber", num.value);
    alert("Number saved");
}

/* LOAD BOOKINGS */
function loadBookings(){
    num.value = localStorage.getItem("ownerNumber") || "";
    let b = JSON.parse(localStorage.getItem("bookings")) || [];
    table.innerHTML = "";

    b.forEach((x,i)=>{
        table.innerHTML += `
        <tr>
            <td>${x.name}</td>
            <td>${x.pickup}</td>
            <td>${x.drop}</td>
            <td>${x.distance}</td>
            <td>â‚¹${x.fare}</td>
            <td>${x.createdAt}</td>
            <td>${x.status}</td>
            <td>
                <button onclick="confirm(${i})">Confirm</button>
                <button class="reject" onclick="reject(${i})">Reject</button>
                <button onclick="del(${i})">Delete</button>
            </td>
        </tr>`;
    });
}

function confirm(i){
    let b = JSON.parse(localStorage.getItem("bookings"));
    b[i].status = "Confirmed";
    localStorage.setItem("bookings", JSON.stringify(b));
    window.open(`https://wa.me/${b[i].phone}?text=Your cab booking is CONFIRMED`);
    loadBookings();
}

function reject(i){
    let b = JSON.parse(localStorage.getItem("bookings"));
    b[i].status = "Rejected";
    localStorage.setItem("bookings", JSON.stringify(b));
    window.open(`https://wa.me/${b[i].phone}?text=Sorry, your booking is REJECTED`);
    loadBookings();
}

function del(i){
    let b = JSON.parse(localStorage.getItem("bookings"));
    b.splice(i,1);
    localStorage.setItem("bookings", JSON.stringify(b));
    loadBookings();
}
</script>

</body>
</html>
